defaultTasks 'clean', 'compile'

configurations {
    generatesrc
}

repositories {
    mavenCentral()
    mavenLocal()
}

dependencies {
    generatesrc 'de.jflex:maven-jflex-plugin:1.4.3'
}

ext {
    base         = '.'
    src          = new File(base, 'src')
    build        = new File(base, 'build')
    dist         = new File(base, '/dist')
    generatedsrc = new File(build, '/generatedsrc')
    workingdirs  = [build, generatedsrc, dist]
}

task clean << {
    delete project.ext.workingdirs
}

task prepare << {
    project.ext.workingdirs.each { File d ->
        d.mkdirs()
    }
}

task generatesrc(dependsOn: prepare) << {
    ant.taskdef(name: 'jflex', classname: 'JFlex.anttask.JFlexTask', classpath: configurations.generatesrc.asPath)

    fileTree(dir: project.ext.src).include('**/*.lex').each { File f ->
        ant.jflex(destdir: project.ext.generatedsrc, file: f)
    }
}

task compile(dependsOn: generatesrc) << {

}